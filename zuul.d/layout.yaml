- job:
    name: tripleo-operator-ansible-release
    parent: base
    run: ci/playbooks/publish_collection.yml
    secrets:
      - name: ansible_galaxy_info
        secret: ansible_galaxy_info_toa

- secret:
    name: ansible_galaxy_info_toa
    data:
      url: https://galaxy.ansible.com
      token: !encrypted/pkcs1-oaep
        - SXQjXSgmtNQeh5e3vElfPvpGfNJcD5Dt9O8ntMUnXspuUWWxPWOtjyhm/o2IEdHvRTEmH
          EcNpj5MoMv+ufk6PbneC93jJQ6NrA5g5AwP7aZsVyrii1JwtxT37XIZPGPkJ3bvz51UFA
          CL0U2KdcPz5vf2gzvf/ZvDB0IRZqEVnmlJHG/b84bS+k28aWHdQ4xB2nlsB5mOhuX4gVN
          2xCgn9rNZwafw9jleuqtMmWYqEICGXWWniLpb8cQAfwXCCpuWnO+2UUremIrocTnbIiQA
          Smz7UuyMWlOFS8KCgM60/yE+QRorpjT3U63eF+V2cpf2gXY5U7P7RWp2OnzTh2eSoH11x
          FJ0b2zqDXnmxougo3+1qD/LO11CSBYdH6PxId5VCRbVS3dHLiHJPR7ABqjT8kpiw7Gmh3
          jAE7Lkk+niAhYr4X+ZcBni1jS3TfAJx5SYMrjLOn5rDbKKk0jTUxfZ6w7aRZxheXTiBOw
          pgE4j/cwi/VpV45WBCN83I2l63Jz4WGJVPDjhNbYOApxmNDFA8RQeShD5cOyxsnOxh7xU
          uyb+385Biuc5O1jLSGDBqWbo1O9tdUBAc3ZhpSSUgSP2MY12RIgpj55Qy5TCvy5+4VKH3
          APbMJDE3uJzdlmRyo6iaFZBziYxYCnvpnH+zYX0VwzdG0WGFUW//OVNE8eN7jM=

- project:
    templates:
      - openstack-python3-ussuri-jobs
      - tripleo-operator-molecule-jobs
      - release-notes-jobs-python3
    check:
      jobs:
        - openstack-tox-linters
        - tripleo-ci-centos-8-content-provider:
            dependencies:
              - openstack-tox-linters
              - openstack-tox-pep8
              - openstack-tox-py36
              - openstack-tox-py37
            files: &content_provider
              - ^roles/tripleo_undercloud_install/.*$
              - ^roles/tripleo_deploy/.*$
              - ^roles/tripleo_container_image_prepare_default/.*$
        - openstack-tox-docs: &tripleo-docs
            files:
            - ^doc/.*
            - ^molecule-requirements.txt
            - ^README.rst
            - ^requirements.txt
        - tripleo-ci-centos-8-containers-multinode: &job_containers_multinode
            vars: &multi_consumer_vars
              consumer_job: true
              build_container_images: false
              tags:
                - undercloud-setup
                - undercloud-scripts
                - undercloud-install
                - undercloud-post-install
                - tripleo-validations
                - overcloud-scripts
                - overcloud-prep-config
                - overcloud-prep-containers
                - overcloud-deploy
                - overcloud-post-deploy
                - overcloud-validate
            dependencies: &deps_content_provider_c8
              - tripleo-ci-centos-8-content-provider
            files: &containers_multinode_files
              - ^roles/tripleo_undercloud_install/.*$
        - tripleo-ci-centos-8-standalone: &job_centos8_standalone
            vars: &sa_consumer_vars
              consumer_job: true
              build_container_images: false
              tags:
                - standalone
            dependencies: *deps_content_provider_c8
            files: &standalone_files
              - ^roles/tripleo_deploy/.*$
              - ^roles/tripleo_container_image_prepare_default/.*$
    gate:
      jobs:
        - openstack-tox-linters
        - tripleo-ci-centos-8-content-provider:
            files: *content_provider
        - openstack-tox-docs: *tripleo-docs
        - tripleo-ci-centos-8-containers-multinode: *job_containers_multinode
        - tripleo-ci-centos-8-standalone: *job_centos8_standalone

    promote:
      jobs:
      - promote-openstack-tox-docs: *tripleo-docs

    tag:
      jobs:
        - tripleo-operator-ansible-release
